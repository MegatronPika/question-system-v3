<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试全量题库</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>测试全量题库API</h2>
        
        <div class="mb-3">
            <button class="btn btn-primary" onclick="testAPI()">测试API</button>
            <button class="btn btn-secondary" onclick="clearLog()">清空日志</button>
        </div>
        
        <div id="result" class="alert alert-info d-none">
            <!-- 结果显示 -->
        </div>
        
        <div id="log" class="border p-3 bg-light" style="height: 400px; overflow-y: auto;">
            <!-- 日志显示 -->
        </div>
    </div>

    <script>
        function log(message) {
            const logDiv = $('#log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.append(`<div>[${timestamp}] ${message}</div>`);
            logDiv.scrollTop(logDiv[0].scrollHeight);
        }
        
        function clearLog() {
            $('#log').empty();
        }
        
        function testAPI() {
            log('开始测试API...');
            
            $.ajax({
                url: '/get_question_bank',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 
                    type_filter: 'all',
                    status_filter: 'all',
                    sort_by: 'id',
                    page: 1,
                    page_size: 100
                }),
                success: function(response) {
                    log('API响应成功');
                    log(`响应数据大小: ${JSON.stringify(response).length} 字符`);
                    log(`单选题数量: ${response.single_choice ? response.single_choice.length : 0}`);
                    log(`多选题数量: ${response.multi_choice ? response.multi_choice.length : 0}`);
                    log(`判断题数量: ${response.true_false ? response.true_false.length : 0}`);
                    log(`总题数: ${response.total_count || 0}`);
                    
                    $('#result').removeClass('d-none alert-danger').addClass('alert-success')
                        .html(`✅ API测试成功！总题数: ${response.total_count || 0}`);
                },
                error: function(xhr, status, error) {
                    log(`API请求失败: ${status} - ${error}`);
                    log(`响应状态码: ${xhr.status}`);
                    log(`响应内容: ${xhr.responseText.substring(0, 200)}...`);
                    
                    $('#result').removeClass('d-none alert-success').addClass('alert-danger')
                        .html(`❌ API测试失败！状态码: ${xhr.status}`);
                }
            });
        }
        
        // 页面加载时自动测试
        $(document).ready(function() {
            log('页面加载完成，准备测试...');
        });
    </script>
</body>
</html>
